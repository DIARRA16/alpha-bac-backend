<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Alpha Bac - Plateforme éducative</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <style>
    body { font-family: system-ui; background-color: #f8fafc; margin: 0; }
    .icon { width: 1.25rem; height: 1.25rem; stroke: currentColor; stroke-width: 2; fill: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script>
    const { useState, useEffect } = React;

    const ADMIN_PASSWORD = "admin123";

    function App() {
      const [view, setView] = useState('login'); // 'login', 'student', 'teacher', 'take-quiz'
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [currentQuiz, setCurrentQuiz] = useState(null);
      const [answers, setAnswers] = useState({});
      const [results, setResults] = useState(null);
      const [timeLeft, setTimeLeft] = useState(600); // 10 minutes

      const initialAssignments = JSON.parse(localStorage.getItem('assignments')) || [
        {
          id: 1,
          title: "Quiz d'algèbre",
          subject: "Mathématiques",
          questions: [
            { id: 1, text: "Résolvez : 2x + 5 = 15", answer: "5", type: "text" },
            { id: 2, text: "Vrai ou Faux : √64 = 8", answer: "true", type: "boolean" }
          ],
          graded: false,
          date: "2025-11-25"
        }
      ];

      const [assignments, setAssignments] = useState(initialAssignments);

      // Sauvegarde dans localStorage
      useEffect(() => {
        localStorage.setItem('assignments', JSON.stringify(assignments));
      }, [assignments]);

      // Chronomètre
      useEffect(() => {
        let timer;
        if (view === 'take-quiz' && timeLeft > 0 && !results) {
          timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);
        }
        return () => clearTimeout(timer);
      }, [timeLeft, view, results]);

      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      // === AUTHENTIFICATION ===
      const loginStudent = () => {
        setView('student');
      };

      const loginTeacher = () => {
        if (password === ADMIN_PASSWORD) {
          setView('teacher');
          setError('');
        } else {
          setError('Mot de passe incorrect');
        }
      };

      const logout = () => {
        setView('login');
        setPassword('');
        setError('');
        setCurrentQuiz(null);
        setAnswers({});
        setResults(null);
        setTimeLeft(600);
      };

      // === ÉLÈVE : PASSER UN DEVOIR ===
      const startQuiz = (quiz) => {
        setCurrentQuiz(quiz);
        setAnswers({});
        setResults(null);
        setTimeLeft(600);
        setView('take-quiz');
      };

      const handleAnswerChange = (questionId, value) => {
        setAnswers(prev => ({ ...prev, [questionId]: value }));
      };

      const submitQuiz = () => {
        if (!currentQuiz) return;

        const quizResults = currentQuiz.questions.map(q => {
          const userAnswer = (answers[q.id] || '').toString().toLowerCase().trim();
          const correctAnswer = q.answer.toString().toLowerCase().trim();
          return {
            questionId: q.id,
            isCorrect: userAnswer === correctAnswer,
            userAnswer: answers[q.id] || ''
          };
        });

        const score = quizResults.filter(r => r.isCorrect).length;
        const total = quizResults.length;
        const percentage = Math.round((score / total) * 100);

        setResults({ quizResults, score, total, percentage });

        // Marquer comme corrigé
        setAssignments(prev => prev.map(a =>
          a.id === currentQuiz.id ? { ...a, graded: true } : a
        ));
      };

      // === ENSEIGNANT : FORMULAIRE ===
      const [showForm, setShowForm] = useState(false);
      const [formTitle, setFormTitle] = useState('');
      const [formSubject, setFormSubject] = useState('');
      const [questions, setQuestions] = useState([{ text: '', answer: '', type: 'text' }]);

      const resetForm = () => {
        setFormTitle('');
        setFormSubject('');
        setQuestions([{ text: '', answer: '', type: 'text' }]);
      };

      const addQuestion = () => {
        setQuestions([...questions, { text: '', answer: '', type: 'text' }]);
      };

      const removeQuestion = (index) => {
        if (questions.length > 1) {
          const newQ = [...questions];
          newQ.splice(index, 1);
          setQuestions(newQ);
        }
      };

      const updateQuestionText = (index, value) => {
        const newQ = [...questions];
        newQ[index].text = value;
        setQuestions(newQ);
      };

      const updateQuestionAnswer = (index, value) => {
        const newQ = [...questions];
        newQ[index].answer = value;
        setQuestions(newQ);
      };

      const updateQuestionType = (index, value) => {
        const newQ = [...questions];
        newQ[index].type = value;
        if (value === 'boolean' && newQ[index].answer !== 'true' && newQ[index].answer !== 'false') {
          newQ[index].answer = 'true';
        }
        setQuestions(newQ);
      };

      const saveAssignment = () => {
        if (!formTitle.trim() || !formSubject.trim()) {
          alert('Titre et matière requis.');
          return;
        }
        if (questions.some(q => !q.text.trim() || !q.answer.trim())) {
          alert('Toutes les questions doivent être complétées.');
          return;
        }

        const newAssignment = {
          id: Date.now(),
          title: formTitle,
          subject: formSubject,
          questions: questions.map((q, i) => ({
            id: i + 1,
            text: q.text,
            answer: q.answer,
            type: q.type
          })),
          graded: false,
          date: new Date().toISOString().split('T')[0]
        };

        setAssignments(prev => [...prev, newAssignment]);
        setShowForm(false);
        resetForm();
        alert('Devoir ajouté avec succès !');
      };

      const deleteAssignment = (id) => {
        if (confirm('Supprimer ce devoir ?')) {
          setAssignments(prev => prev.filter(a => a.id !== id));
        }
      };

      // === VUES ===
      if (view === 'login') {
        return React.createElement('div', { className: 'min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-4' },
          React.createElement('div', { className: 'bg-white p-8 rounded-xl shadow-lg w-full max-w-md' },
            React.createElement('div', { className: 'text-center mb-6' },
              React.createElement('div', { className: 'mx-auto bg-blue-600 w-16 h-16 rounded-full flex items-center justify-center mb-3 text-white' },
                React.createElement('svg', { className: 'icon', viewBox: '0 0 24 24' },
                  React.createElement('path', { d: 'M4 19.5v-15A2.5 2.5 0 016.5 2H19a1 1 0 011 1v18a1 1 0 01-1 1H6.5a2.5 2.5 0 010-5H20' })
                )
              ),
              React.createElement('h1', { className: 'text-2xl font-bold text-gray-800' }, 'Alpha Bac'),
              React.createElement('p', { className: 'text-gray-600' }, 'Plateforme éducative')
            ),
            React.createElement('button', {
              onClick: loginStudent,
              className: 'w-full bg-green-600 text-white py-3 rounded-lg font-medium hover:bg-green-700 mb-4'
            }, 'Accès Étudiant'),
            React.createElement('div', { className: 'border-t pt-4' },
              React.createElement('p', { className: 'text-center text-gray-700 mb-2' }, 'Accès Enseignant'),
              React.createElement('input', {
                type: 'password',
                placeholder: 'Mot de passe',
                value: password,
                onChange: (e) => setPassword(e.target.value),
                className: 'w-full p-3 border border-gray-300 rounded mb-2'
              }),
              error && React.createElement('p', { className: 'text-red-500 text-sm text-center mb-2' }, error),
              React.createElement('button', {
                onClick: loginTeacher,
                className: 'w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700'
              }, 'Se connecter')
            )
          )
        );
      }

      // === ÉLÈVE : LISTE DES DEVOIRS ===
      if (view === 'student') {
        return React.createElement('div', { className: 'min-h-screen bg-gray-100 p-4' },
          React.createElement('div', { className: 'max-w-6xl mx-auto' },
            React.createElement('div', { className: 'flex justify-between items-center mb-6' },
              React.createElement('h1', { className: 'text-2xl font-bold text-gray-800' }, 'Alpha Bac - Espace Élève'),
              React.createElement('button', {
                onClick: logout,
                className: 'text-red-600 hover:underline flex items-center'
              }, 'Déconnexion')
            ),
            assignments.length === 0
              ? React.createElement('p', { className: 'text-gray-600' }, 'Aucun devoir pour le moment.')
              : React.createElement('div', { className: 'grid gap-6 md:grid-cols-2 lg:grid-cols-3' },
                  assignments.map(quiz =>
                    React.createElement('div', { key: quiz.id, className: 'bg-white rounded-lg shadow p-5' },
                      React.createElement('h3', { className: 'font-bold text-lg text-gray-800 mb-2' }, quiz.title),
                      React.createElement('p', { className: 'text-gray-600 mb-1' }, quiz.subject),
                      React.createElement('p', { className: 'text-sm text-gray-500 mb-4' }, quiz.questions.length + ' questions'),
                      React.createElement('button', {
                        onClick: () => startQuiz(quiz),
                        className: 'w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700'
                      }, 'Commencer le devoir')
                    )
                  )
                )
          )
        );
      }

      // === ÉLÈVE : PASSER LE DEVOIR ===
      if (view === 'take-quiz') {
        if (!currentQuiz) return React.createElement('p', null, 'Erreur : devoir non trouvé.');

        return React.createElement('div', { className: 'min-h-screen bg-gray-100 p-4' },
          React.createElement('div', { className: 'max-w-4xl mx-auto' },
            React.createElement('div', { className: 'bg-white rounded-lg shadow p-6 mb-6' },
              React.createElement('div', { className: 'flex justify-between items-start mb-6' },
                React.createElement('div', null,
                  React.createElement('h1', { className: 'text-2xl font-bold text-gray-800' }, currentQuiz.title),
                  React.createElement('p', { className: 'text-gray-600' }, currentQuiz.subject)
                ),
                React.createElement('div', { className: 'bg-red-100 text-red-800 px-3 py-1 rounded-full flex items-center' },
                  React.createElement('svg', { className: 'icon mr-1', viewBox: '0 0 24 24' },
                    React.createElement('circle', { cx: '12', cy: '12', r: '10' }),
                    React.createElement('polyline', { points: '12 6 12 12 16 14' })
                  ),
                  React.createElement('span', null, formatTime(timeLeft))
                )
              ),

              !results ? (
                React.createElement(React.Fragment, null,
                  currentQuiz.questions.map((q, idx) =>
                    React.createElement('div', { key: q.id, className: 'mb-6 p-4 border border-gray-200 rounded bg-gray-50' },
                      React.createElement('p', { className: 'font-medium mb-3' },
                        React.createElement('span', { className: 'text-blue-600 font-bold mr-2' }, idx + 1 + '.'),
                        q.text
                      ),
                      q.type === 'boolean'
                        ? React.createElement('div', { className: 'space-y-2' },
                            React.createElement('label', { className: 'flex items-center space-x-2 cursor-pointer' },
                              React.createElement('input', {
                                type: 'radio',
                                name: 'q' + q.id,
                                value: 'true',
                                checked: answers[q.id] === 'true',
                                onChange: (e) => handleAnswerChange(q.id, e.target.value),
                                className: 'text-blue-600'
                              }),
                              React.createElement('span', null, 'Vrai')
                            ),
                            React.createElement('label', { className: 'flex items-center space-x-2 cursor-pointer' },
                              React.createElement('input', {
                                type: 'radio',
                                name: 'q' + q.id,
                                value: 'false',
                                checked: answers[q.id] === 'false',
                                onChange: (e) => handleAnswerChange(q.id, e.target.value),
                                className: 'text-blue-600'
                              }),
                              React.createElement('span', null, 'Faux')
                            )
                          )
                        : React.createElement('input', {
                            type: 'text',
                            value: answers[q.id] || '',
                            onChange: (e) => handleAnswerChange(q.id, e.target.value),
                            placeholder: 'Votre réponse...',
                            className: 'w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500'
                          })
                    )
                  ),
                  React.createElement('div', { className: 'text-center mt-6' },
                    React.createElement('button', {
                      onClick: submitQuiz,
                      disabled: timeLeft <= 0,
                      className: 'bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 disabled:opacity-50'
                    }, 'Soumettre et Corriger')
                  )
                )
              ) : (
                React.createElement('div', { className: 'text-center py-8' },
                  React.createElement('div', { className: 'inline-block bg-green-100 rounded-full p-4 mb-6' },
                    React.createElement('svg', { className: 'icon text-green-600 w-12 h-12 mx-auto', viewBox: '0 0 24 24' },
                      React.createElement('circle', { cx: '12', cy: '8', r: '7' }),
                      React.createElement('polyline', { points: '8.21 13.89 7 23 12 20 17 23 15.79 13.88' })
                    )
                  ),
                  React.createElement('h2', { className: 'text-2xl font-bold mb-2' }, 'Résultats'),
                  React.createElement('p', { className: 'text-4xl font-bold text-green-600 mb-2' }, results.score + ' / ' + results.total),
                  React.createElement('p', { className: 'text-gray-700 mb-8' }, results.percentage + '% de réussite'),

                  results.quizResults.map(r => {
                    const q = currentQuiz.questions.find(x => x.id === r.questionId);
                    return React.createElement('div', {
                      key: r.questionId,
                      className: 'flex items-start space-x-3 p-3 bg-white border rounded mb-3'
                    },
                      r.isCorrect
                        ? React.createElement('svg', { className: 'icon text-green-600 mt-0.5', viewBox: '0 0 24 24' },
                            React.createElement('polyline', { points: '20 6 9 17 4 12' })
                          )
                        : React.createElement('svg', { className: 'icon text-red-600 mt-0.5', viewBox: '0 0 24 24' },
                            React.createElement('line', { x1: '18', y1: '6', x2: '6', y2: '18' }),
                            React.createElement('line', { x1: '6', y1: '6', x2: '18', y2: '18' })
                          ),
                      React.createElement('div', { className: 'text-left flex-1' },
                        React.createElement('p', { className: 'font-medium' }, q.text),
                        React.createElement('p', { className: 'text-gray-600' },
                          'Votre réponse : ',
                          React.createElement('span', { className: 'font-semibold' }, r.userAnswer || '—')
                        ),
                        !r.isCorrect && React.createElement('p', { className: 'text-red-600' }, 'Bonne réponse : ' + q.answer)
                      )
                    );
                  }),

                  React.createElement('button', {
                    onClick: () => setView('student'),
                    className: 'mt-6 bg-gray-600 text-white px-6 py-2 rounded hover:bg-gray-700'
                  }, 'Retour à mes devoirs')
                )
              )
            )
          )
        );
      }

      // === ENSEIGNANT ===
      if (view === 'teacher') {
        return React.createElement('div', { className: 'min-h-screen bg-gray-100 p-4' },
          React.createElement('div', { className: 'max-w-6xl mx-auto' },
            React.createElement('div', { className: 'flex justify-between items-center mb-6' },
              React.createElement('h1', { className: 'text-2xl font-bold text-gray-800' }, 'Alpha Bac - Espace Enseignant'),
              React.createElement('button', {
                onClick: logout,
                className: 'text-red-600 hover:underline flex items-center'
              }, 'Déconnexion')
            ),

            React.createElement('button', {
              onClick: () => setShowForm(!showForm),
              className: 'mb-6 bg-blue-600 text-white px-4 py-2 rounded flex items-center'
            }, '+ Ajouter un devoir'),

            // Formulaire
            showForm && React.createElement('div', { className: 'bg-white p-6 rounded shadow mb-8' },
              React.createElement('h3', { className: 'font-bold mb-4' }, 'Nouveau devoir'),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Titre du devoir',
                value: formTitle,
                onChange: (e) => setFormTitle(e.target.value),
                className: 'w-full p-2 border border-gray-300 rounded mb-3'
              }),
              React.createElement('input', {
                type: 'text',
                placeholder: 'Matière',
                value: formSubject,
                onChange: (e) => setFormSubject(e.target.value),
                className: 'w-full p-2 border border-gray-300 rounded mb-4'
              }),

              questions.map((q, i) =>
                React.createElement('div', { key: i, className: 'border rounded p-3 mb-3 bg-gray-50' },
                  React.createElement('div', { className: 'flex justify-between items-center mb-2' },
                    React.createElement('span', { className: 'text-sm font-medium' }, 'Question ' + (i + 1)),
                    questions.length > 1 && React.createElement('button', {
                      onClick: () => removeQuestion(i),
                      className: 'text-red-500 text-sm'
                    }, 'Supprimer')
                  ),
                  React.createElement('input', {
                    type: 'text',
                    placeholder: 'Énoncé de la question',
                    value: q.text,
                    onChange: (e) => updateQuestionText(i, e.target.value),
                    className: 'w-full p-2 border border-gray-300 rounded mb-2'
                  }),
                  React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-2' },
                    React.createElement('select', {
                      value: q.type,
                      onChange: (e) => updateQuestionType(i, e.target.value),
                      className: 'p-2 border border-gray-300 rounded'
                    },
                      React.createElement('option', { value: 'text' }, 'Texte'),
                      React.createElement('option', { value: 'boolean' }, 'Vrai/Faux')
                    ),
                    q.type === 'boolean'
                      ? React.createElement('select', {
                          value: q.answer,
                          onChange: (e) => updateQuestionAnswer(i, e.target.value),
                          className: 'p-2 border border-gray-300 rounded'
                        },
                          React.createElement('option', { value: 'true' }, 'Vrai'),
                          React.createElement('option', { value: 'false' }, 'Faux')
                        )
                      : React.createElement('input', {
                          type: 'text',
                          placeholder: 'Réponse correcte',
                          value: q.answer,
                          onChange: (e) => updateQuestionAnswer(i, e.target.value),
                          className: 'p-2 border border-gray-300 rounded'
                        })
                  )
                )
              ),

              React.createElement('button', {
                onClick: addQuestion,
                className: 'text-blue-600 mb-4 flex items-center'
              }, '+ Ajouter une question'),

              React.createElement('div', { className: 'flex space-x-2' },
                React.createElement('button', {
                  onClick: saveAssignment,
                  className: 'bg-green-600 text-white px-4 py-2 rounded'
                }, 'Enregistrer le devoir'),
                React.createElement('button', {
                  onClick: () => { setShowForm(false); resetForm(); },
                  className: 'bg-gray-500 text-white px-4 py-2 rounded'
                }, 'Annuler')
              )
            ),

            // Liste des devoirs
            React.createElement('h2', { className: 'text-xl font-bold mb-4' }, 'Devoirs existants'),
            assignments.length === 0
              ? React.createElement('p', null, 'Aucun devoir.')
              : React.createElement('div', { className: 'space-y-4' },
                  assignments.map(quiz =>
                    React.createElement('div', { key: quiz.id, className: 'bg-white p-4 rounded shadow flex justify-between items-center' },
                      React.createElement('div', null,
                        React.createElement('h3', { className: 'font-bold' }, quiz.title),
                        React.createElement('p', { className: 'text-gray-600 text-sm' }, quiz.subject + ' • ' + quiz.questions.length + ' questions'),
                        React.createElement('p', { className: 'text-xs text-gray-500 mt-1' }, 'Créé le ' + quiz.date)
                      ),
                      React.createElement('div', { className: 'flex space-x-3' },
                        React.createElement('span', {
                          className: `px-3 py-1 rounded-full text-xs ${
                            quiz.graded ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                          }`
                        }, quiz.graded ? 'Corrigé' : 'Non corrigé'),
                        React.createElement('button', {
                          onClick: () => deleteAssignment(quiz.id),
                          className: 'text-red-600 hover:text-red-800'
                        }, 'Supprimer')
                      )
                    )
                  )
                )
          )
        );
      }

      return null;
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
